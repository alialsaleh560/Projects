import boto3
from datetime import datetime, timedelta
import json

dynamodb = boto3.resource('dynamodb', region_name='us-east-1')
table = dynamodb.Table('HoneypotMalwareAnalysis')

def generate_report():
    # Scan all malware samples
    response = table.scan()
    items = response['Items']
    
    print("=" * 60)
    print("HONEYPOT MALWARE ANALYSIS REPORT")
    print("=" * 60)
    print(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print(f"Total Samples: {len(items)}\n")
    
    for idx, item in enumerate(items, 1):
        print(f"\n--- Sample #{idx} ---")
        print(f"Filename: {item['filename']}")
        print(f"SHA256: {item['sha256']}")
        print(f"MD5: {item['md5']}")
        print(f"Size: {item['filesize']} bytes")
        print(f"Captured: {datetime.fromtimestamp(int(item['timestamp']))}")
        print(f"VirusTotal: {item.get('virustotal', 'N/A')}")
        print(f"S3 Location: {item['s3_location']}")
        
        strings = item.get('strings_sample', '')
        if strings:
            print(f"\nExtracted Strings (sample):")
            print(strings[:200])
        
        print("-" * 60)
    
    print("\n" + "=" * 60)
    print("END OF REPORT")
    print("=" * 60)

if __name__ == "__main__":
    generate_report()
